library(sf)
library(scales)
library(dplyr)
library(tidyr)
library(ggplot2)

setwd("./data/processed")

df = read.csv("gap_table.csv") %>% select(-X)

idx = which(startsWith(colnames(df), "adj_gap"))
longgaps = pivot_longer(
  df, cols=idx,
  names_prefix = "adj_gap_",
  names_to="crop",
  values_to="gap"
)

ggplot(longgaps) +
  geom_line(aes(year, gap, col=NUTS_ID)) +
  facet_wrap(~crop, scales="free") +
  theme_bw()

write.csv(longgaps, "gaps_longformat.csv")

df = read.csv("rel_gap_table.csv") %>% select(-X)

idx = which(startsWith(colnames(df), "rel_gap"))
longgaps = pivot_longer(
  df, cols=idx,
  names_prefix = "rel_gap_",
  names_to="crop",
  values_to="rel_gap"
)

ggplot(longgaps) +
  geom_line(aes(year, rel_gap, col=NUTS_ID)) +
  facet_wrap(~crop, scales="free") +
  theme_bw() +ylim(-1,1) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

write.csv(longgaps, "relative_gaps_longformat.csv")